{% extends 'base.html.twig' %}

 {% block stylesheets %}
     {{ parent() }}
     <link rel="stylesheet" href="{{ asset('css/connexion.css') }}" />
     <link href="https://cdn.jsdelivr.net/npm/smartwizard@5/dist/css/smart_wizard_all.min.css" rel="stylesheet" type="text/css" />
     <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
     <style>



         .sw-theme-arrows>.nav .nav-link.done {
             border-color: darkgrey;
             border-top-color: darkgrey;
             border-right-color: darkgrey;
             border-bottom-color: darkgrey;
             border-left-color: darkgrey;
             background: darkgrey;
             background-color: darkgrey;
         }

         .sw-theme-arrows>.nav .nav-link.done::after {
             border-left-color: darkgrey;
         }

         .sw-theme-arrows>.nav .nav-link.done {
             border-color: darkgrey;
             border-top-color: darkgrey;
             border-right-color: darkgrey;
             border-bottom-color: darkgrey;
             border-left-color: darkgrey;
             background: darkgrey;
             background-color: darkgrey;
             color: black;
         }

         .sw-theme-arrows>.nav .nav-link.active {
             border-color: #FF7900;
             border-top-color: #FF7900;
             border-right-color: #FF7900;
             border-bottom-color: #FF7900;
             border-left-color: #FF7900;
             background: #FF7900;
             background-color:#FF7900;

             color: black;
         }

         .sw-theme-arrows>.nav .nav-link.active::after {
             border-left-color: #FF7900;
             color: black;
         }


         .sw-theme-arrows>.nav .nav-link.active {

             border-color: #FF7900;
             border-top-color: #FF7900;
             border-right-color: #FF7900;
             border-bottom-color: #FF7900;
             border-left-color: #FF7900;
             background-color:#FF7900;
             color: black;

         }

         .sw-theme-arrows .toolbar>.btn{
             background-color: #FF7900;
             border-color: #FF7900;
             color: black;
         }





     </style>


 {% endblock  %}

{% block body  %}
    <body class="d-flex flex-column">
    <main class="container-fluid flex-fill ">
        <br>
        <h1 class="text-center">Ajout d'un projet </h1>
        <br>
        {{ form_start(form, {'attr': {'id': 'myForm'}}) }}
        <div id="smartwizard">

            <ul class="nav" >
                <li class="nav-item">
                    <a class="nav-link" href="#step-1">
                        Description
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#step-2">
                        Planification
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#step-3">
                        Coût
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#step-4">
                        Modalités de réception
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#step-5">
                        Step 5
                    </a>
                </li>

            </ul>

            <div class="tab-content" id="tab-content">
                <div id="step-1" class="tab-pane" role="tabpanel" aria-labelledby="step-1">
                    <table style="border-color: white;width: 100%">
                        <tr style="border-color: white">
                            <th width="15%">

                                {{ form_label(form, 'Référence FL', {
                                    'label_attr': {'class': 'input-group-text'}}) }}</th>
                            <th width="20%">
                                {{ form_widget(form.reference, {
                                    'label_attr': {'class': 'form_control'}}
                                ) }}
                            </th>
                            <th width="50%">
                                {{ form_label(form.reference) }}
                            </th>

                        </tr>
                        <tr>
                            <th> {{ form_label(form, 'Chef de projet', {
                                    'label_attr': {'class': 'input-group-text'}}) }}</th>
                            <th >{{ form_widget(form.user, {
                                    'label_attr': {'class': 'form_control'}}
                                ) }}</th>


                        </tr>

                        <tr style="border-color: white" >
                            <th>

                                {{ form_label(form, 'Phase', {
                                    'label_attr': {'class': 'input-group-text'}}) }}</th>
                            <th>
                                {{ form_widget(form.Phase, {
                                    'label_attr': {'class': 'form_control'}}
                                ) }}
                            </th>

                        </tr>
                        <tr>
                            <th> {{ form_label(form, 'Domaine', {
                                    'label_attr': {'class': 'input-group-text'}}) }}</th>
                            <th>{{ form_widget(form.domaine, {
                                    'label_attr': {'class': 'form_control'}}
                                ) }}</th>

                        </tr>
                        <tr>
                            <th> {{ form_label(form, 'Sous-domaine', {
                                    'label_attr': {'class': 'input-group-text'}}) }}</th>
                            <th>{{ form_widget(form.sdomaine, {
                                    'label_attr': {'class': 'form_control'}}
                                ) }}</th>

                        </tr>

                        <tr>
                            <th> {{ form_label(form, 'Fournisseur', {
                                    'label_attr': {'class': 'input-group-text'}}) }}</th>
                            <th>{{ form_widget(form.fournisseur, {
                                    'label_attr': {'class': 'form_control'}}
                                ) }}</th>

                        </tr>

                        <tr>
                            <th> {{ form_label(form, 'Type de BU', {
                                    'label_attr': {'class': 'input-group-text'}}) }}</th>
                            <th>{{ form_widget(form.typebu, {
                                    'label_attr': {'class': 'form_control'}}
                                ) }}</th>

                        </tr>
                        <tr>
                            <th> {{ form_label(form, 'Priorité', {
                                    'label_attr': {'class': 'input-group-text'}}) }}</th>
                            <th>{{ form_widget(form.priorite, {
                                    'label_attr': {'class': 'form_control'}}
                                ) }}</th>

                        </tr>
                        <tr style="border-color: white">
                            <th>

                                {{ form_label(form, 'Risque', {
                                    'label_attr': {'class': 'input-group-text'}}) }}</th>
                            <th>
                                {{ form_widget(form.risque, {
                                    'label_attr': {'class': 'form_control'}}
                                ) }}
                            </th>

                        </tr>
                        <tr>
                            <th> {{ form_label(form, 'Description', {
                                    'label_attr': {'class': 'input-group-text'}}) }}</th>
                            <th>{{ form_widget(form.description, {
                                    'label_attr': {'class': 'form_control'}}
                                ) }}</th>

                        </tr>


                    </table>

                </div>


                <div id="step-2" class="tab-pane" role="tabpanel" aria-labelledby="step-2">

                    <table style="border-color: white">

                       <tr id="datespec">
                            <th> {{ form_label(form, 'Date de spécifications', {
                                    'label_attr': {'class': 'input-group-text'}}) }}</th>
                            <th>{{ form_widget(form.datespec, {
                                    'label_attr': {'class': 'form_control'}}
                                ) }}</th>
                        </tr>

                        <tr id="datel1">
                            <th> {{ form_label(form, 'Date T-1', {
                                    'label_attr': {'class': 'input-group-text'}}) }}</th>
                            <th>{{ form_widget(form.datel1, {
                                    'label_attr': {'class': 'form_control'}}
                                ) }}</th>
                        </tr>
                        <tr id="date0">
                            <th> {{ form_label(form, 'Date T0', {
                                    'label_attr': {'class': 'input-group-text'}}) }}</th>
                            <th>{{ form_widget(form.date0, {
                                    'label_attr': {'class': 'form_control'}}
                                ) }}</th>
                        </tr>

                        <tr id="date1">
                            <th> {{ form_label(form, 'Date T1', {
                                    'label_attr': {'class': 'input-group-text'}}) }}</th>
                            <th>{{ form_widget(form.date1, {
                                    'label_attr': {'class': 'form_control'}}
                                ) }}</th>
                        </tr>
                        <tr id="date2">
                            <th> {{ form_label(form, 'Date T2', {
                                    'label_attr': {'class': 'input-group-text'}}) }}</th>
                            <th>{{ form_widget(form.date2, {
                                    'label_attr': {'class': 'form_control'}}
                                ) }}</th>
                        </tr>
                        <tr id="date3">
                            <th> {{ form_label(form, 'Date T3', {
                                    'label_attr': {'class': 'input-group-text'}}) }}</th>
                            <th>{{ form_widget(form.date3, {
                                    'label_attr': {'class': 'form_control'}}
                                ) }}</th>
                        </tr>
                    </table>
                </div>


                <div id="step-3" class="tab-pane" role="tabpanel" aria-labelledby="step-3">

                </div>

                <div id="step-4" class="tab-pane" role="tabpanel" aria-labelledby="step-4">
                    <table>
                        <tr>
                            <th> {{ form_label(form, 'Mode de paiement', {
                                    'label_attr': {'class': 'input-group-text'}}) }}</th>
                            <th>{{ form_widget(form.paiement, {
                                    'label_attr': {'class': 'form_control'}}
                                ) }}</th>
                        </tr>
                    </table>
                </div>

                <div id="step-5" class="tab-pane" role="tabpanel" aria-labelledby="step-5">
                    Veuillez vérifier vos données avant de soumettre le formulaire
                </div>

            </div>
        </div>
        {#        </form>#}

        {{ form_end(form) }}
    </main>
    </body>


{% endblock  %}

{% block javascripts %}
    {{ parent() }}
    <script src="https://cdn.jsdelivr.net/npm/smartwizard@5/dist/js/jquery.smartWizard.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-visible/1.2.0/jquery.visible.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.3/dist/jquery.validate.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.3/dist/jquery.validate.min.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.3/dist/additional-methods.js" type="text/javascript"></script>
    <script src=" https://cdn.jsdelivr.net/npm/jquery-validation@1.19.3/dist/additional-methods.min.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>




    $(document).ready(function () {
        $('.projet_fournisseur').change(function() {
            $phasin=document.getElementById('projet_fournisseur').value;
            $.ajax({
            method: "POST",
            url: "{{ path('projet_new') }}",
            data: {id: $phasin},
            dataType: "json",
            success: function(html) {
                console.log(html);
                }


        }).done( function(response) {
            //alert(123);
            var htmlToDisplay = response.trim();
            $("#your_div").html(response);
        }).fail(function(jxh,textmsg,errorThrown){
            console.log(textmsg);
            console.log(errorThrown);
        });
        });






        $('.projet_Phase').change(function() {
            $phasing=document.getElementById('projet_Phase');
            document.getElementById('projet_datel1').value=null;
            document.getElementById('projet_date0').value=null;
            document.getElementById('projet_date1').value=null;
            document.getElementById('projet_date2').value=null;
            document.getElementById('projet_date3').value=null;
            document.getElementById('projet_datespec').value=null;
            var selectValue = $phasing.options[$phasing.selectedIndex].value;
            if ((selectValue=='1')|| (selectValue=='2')|| (selectValue=='3')){//abondonne

                document.getElementById('projet_datel1').style.display="none";
                document.getElementById('datel1').style.display="none";
                document.getElementById("projet_datel1").required=true;

                document.getElementById('projet_date0').style.display="none";
                document.getElementById('date0').style.display="none";
                document.getElementById("projet_date0").required=false;

                document.getElementById('projet_date1').style.display="none";
                document.getElementById('date1').style.display="none";
                document.getElementById("projet_date1").required=false;

                document.getElementById('projet_date2').style.display="none";
                document.getElementById('date2').style.display="none";
                document.getElementById("projet_date2").required=false;

                document.getElementById('projet_date3').style.display="none";
                document.getElementById('date3').style.display="none";
                document.getElementById("projet_date3").required=false;

                document.getElementById('projet_datespec').style.display="none";
                document.getElementById('datespec').style.display="none";
                document.getElementById("projet_datespec").required=false;

            }



            else if (selectValue=='4'){//cadrage

                document.getElementById('projet_datel1').style.display="block";
                document.getElementById('datel1').style.display="block";
                document.getElementById("projet_datel1").required=true;

                document.getElementById('projet_date0').style.display="none";
                document.getElementById('date0').style.display="none";
                document.getElementById("projet_date0").required=false;

                document.getElementById('projet_date1').style.display="none";
                document.getElementById('date1').style.display="none";
                document.getElementById("projet_date1").required=false;

                document.getElementById('projet_date2').style.display="none";
                document.getElementById('date2').style.display="none";
                document.getElementById("projet_date2").required=false;

                document.getElementById('projet_date3').style.display="none";
                document.getElementById('date3').style.display="none";
                document.getElementById("projet_date3").required=false;

                document.getElementById('projet_datespec').style.display="none";
                document.getElementById('datespec').style.display="none";
                document.getElementById("projet_datespec").required=false;

            }
            else if (selectValue=='5'){//etude

                document.getElementById('projet_datel1').style.display="block";
                document.getElementById('datel1').style.display="block";
                document.getElementById("projet_datel1").required=false;

                document.getElementById('projet_date0').style.display="block";
                document.getElementById('date0').style.display="block";
                document.getElementById("projet_date0").required=true;

                document.getElementById('projet_date1').style.display="none";
                document.getElementById('date1').style.display="none";
                document.getElementById("projet_date1").required=false;

                document.getElementById('projet_date2').style.display="none";
                document.getElementById('date2').style.display="none";
                document.getElementById("projet_date2").required=false;

                document.getElementById('projet_date3').style.display="none";
                document.getElementById('date3').style.display="none";
                document.getElementById("projet_date3").required=false;

                document.getElementById('projet_datespec').style.display="none";
                document.getElementById('datespec').style.display="none";
                document.getElementById("projet_datespec").required=false;

            }

            else if ((selectValue=='6')){//construction
                document.getElementById('projet_datel1').style.display="block";
                document.getElementById('datel1').style.display="block";
                document.getElementById("projet_datel1").required=false;

                document.getElementById('projet_date0').style.display="block";
                document.getElementById('date0').style.display="block";
                document.getElementById("projet_date0").required=false;

                document.getElementById('projet_date1').style.display="block";
                document.getElementById('date1').style.display="block";
                document.getElementById("projet_date1").required=true;

                document.getElementById('projet_date2').style.display="block";
                document.getElementById('date2').style.display="block";
                document.getElementById("projet_date2").required=true;

                document.getElementById('projet_date3').style.display="block";
                document.getElementById('date3').style.display="block";
                document.getElementById("projet_date3").required=true;

                document.getElementById('projet_datespec').style.display="block";
                document.getElementById('datespec').style.display="block";
                document.getElementById("projet_datespec").required=true;
            }



            else if ((selectValue=='6')|| (selectValue=='7')|| (selectValue=='8')|| (selectValue=='9')){//construction
                document.getElementById('projet_datel1').style.display="block";
                document.getElementById('datel1').style.display="block";
                document.getElementById("projet_datel1").required=false;

                document.getElementById('projet_date0').style.display="block";
                document.getElementById('date0').style.display="block";
                document.getElementById("projet_date0").required=false;

                document.getElementById('projet_date1').style.display="block";
                document.getElementById('date1').style.display="block";
                document.getElementById("projet_date1").required=false;

                document.getElementById('projet_date2').style.display="block";
                document.getElementById('date2').style.display="block";
                document.getElementById("projet_date2").required=false;

                document.getElementById('projet_date3').style.display="block";
                document.getElementById('date3').style.display="block";
                document.getElementById("projet_date3").required=false;

                document.getElementById('projet_datespec').style.display="block";
                document.getElementById('datespec').style.display="block";
                document.getElementById("projet_datespec").required=false;
            }





        });



    var $collectionHolder;
    var $boutonAjouter = $('<button type="button" className="btn-toolbar add_profil_link sm btn btn-sm text-black"style="background-color: lightgrey">Ajouter un profil</button>');
    var $nouveau = $('<li></li>').append($boutonAjouter )
    ;
    jQuery(document).ready(function () {$collectionHolder = $('ul.profils');
    $collectionHolder.find('li').each(function () {
    addProfilFormDeleteLink($(this));
    });
    $collectionHolder.append($nouveau);
    $collectionHolder.data('index', $collectionHolder.find('input').length);
    $boutonAjouter.on('click', function (e) {addProfilForm($collectionHolder, $nouveau);
    });

    function addProfilForm($collectionHolder, $newLinkLi) {
    var prototype = $collectionHolder.data('prototype');
    var index = $collectionHolder.data('index');
    var newForm = prototype;
    newForm = newForm.replace(/__name__/g, index);
    $collectionHolder.data('index', index + 1);
    var $newFormLi = $('<li></li>').append(newForm);
    $newLinkLi.before($newFormLi);
    addProfilFormDeleteLink($newFormLi);
    document.getElementById('smartwizard').style.height = "200%";
    document.getElementById('tab-content').style.height = "200%";


    }
    function addProfilFormDeleteLink($tagFormLi) {
    var $removeFormButton = $('<button type="button" class="btn-toolbar btn btn-sm text-black" style="background-color: lightgrey; margin-bottom: 2%; font-size: 1em ">Supprimer le profil</button>');
    $tagFormLi.append($removeFormButton);
    $removeFormButton.on('click', function (e) {
    $tagFormLi.remove();
    });
    }
    })
    ;


    var btnFinish = $('<button></button>').text('Ajouter').addClass('btn btn-info sw-btn-group-extra d-none')
    .on('click', function(){


    onsubmit();


    });



    $('#smartwizard').smartWizard({
    selected: 0, // Initial selected step, 0 = first step
    theme: 'arrows', // theme for the wizard, related css need to include for other than default theme
    justified: true, // Nav menu justification. true/false
    darkMode:false, // Enable/disable Dark Mode if the theme supports. true/false
    autoAdjustHeight: true, // Automatically adjust content height
    cycleSteps: false, // Allows to cycle the navigation of steps
    backButtonSupport: true, // Enable the back button support
    enableURLhash: false, // Enable selection of the step based on url hash
    transition: {
    animation: 'none', // Effect on navigation, none/fade/slide-horizontal/slide-vertical/slide-swing
    speed: '400', // Transion animation speed
    easing:'' // Transition animation easing. Not supported without a jQuery easing plugin
    },
    toolbarSettings: {
    toolbarPosition: 'bottom', // none, top, bottom, both
    toolbarButtonPosition: 'right', // left, right, center
    showNextButton: true, // show/hide a Next button
    showPreviousButton: true, // show/hide a Previous button
    toolbarExtraButtons: [btnFinish] // Extra buttons to show on toolbar, array of jQuery input/buttons elements

    },
    anchorSettings: {
    anchorClickable: true, // Enable/Disable anchor navigation
    enableAllAnchors: false, // Activates all anchors clickable all times
    markDoneStep: true, // Add done state on navigation
    markAllPreviousStepsAsDone: true, // When a step selected by url hash, all previous steps are marked done
    removeDoneStepOnNavigateBack: false, // While navigate back done step after active step will be cleared
    enableAnchorOnDoneStep: true // Enable/Disable the done steps navigation
    },
    keyboardSettings: {
    keyNavigation: true, // Enable/Disable keyboard navigation(left and right keys are used if enabled)
    keyLeft: [37], // Left key code
    keyRight: [39] // Right key code
    },
    lang: { // Language variables for button
    next: 'Suivant',
    previous: 'Précédant'
    },
    disabledSteps: [], // Array Steps disabled
    errorSteps: [], // Highlight step with errors
    hiddenSteps: [], // Hidden steps

    });





    $("#myForm").validate( {

    });

    $('#smartwizard').on("leaveStep", function(e, anchorObject, stepNumber, stepDirection) {
    if ($('#myForm').valid()) {
    if(stepDirection == "4") //here is the final step: Note: 0,1,2
    {
    $('.sw-btn-group-extra').removeClass('d-none');
    }
    else
    {
    $('.sw-btn-group-extra').addClass('d-none');
    return true;
    }



    } else {
    return false
    }
    return true;

    })



























    })

    </script>


{% endblock  %}