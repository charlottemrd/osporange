{% extends 'base.html.twig' %}

 {% block stylesheets %}
     {{ parent() }}
     <link rel="stylesheet" href="{{ asset('css/connexion.css') }}" />
     <link href="https://cdn.jsdelivr.net/npm/smartwizard@5/dist/css/smart_wizard_all.min.css" rel="stylesheet" type="text/css" />
    <style>

        .sw-theme-arrows>.nav .nav-link.done {
            border-color: darkgrey;
            border-top-color: darkgrey;
            border-right-color: darkgrey;
            border-bottom-color: darkgrey;
            border-left-color: darkgrey;
            background: darkgrey;
            background-color: darkgrey;
        }

        .sw-theme-arrows>.nav .nav-link.done::after {
            border-left-color: darkgrey;
        }

        .sw-theme-arrows>.nav .nav-link.done {
            border-color: darkgrey;
            border-top-color: darkgrey;
            border-right-color: darkgrey;
            border-bottom-color: darkgrey;
            border-left-color: darkgrey;
            background: darkgrey;
            background-color: darkgrey;
            color: black;
        }

        .sw-theme-arrows>.nav .nav-link.active {
            border-color: #FF7900;
            border-top-color: #FF7900;
            border-right-color: #FF7900;
            border-bottom-color: #FF7900;
            border-left-color: #FF7900;
            background: #FF7900;
            background-color:#FF7900;

            color: black;
        }

        .sw-theme-arrows>.nav .nav-link.active::after {
            border-left-color: #FF7900;
            color: black;
        }


        .sw-theme-arrows>.nav .nav-link.active {

            border-color: #FF7900;
            border-top-color: #FF7900;
            border-right-color: #FF7900;
            border-bottom-color: #FF7900;
            border-left-color: #FF7900;
            background-color:#FF7900;
            color: black;

        }

        .sw-theme-arrows .toolbar>.btn{
            background-color: #FF7900;
            border-color: #FF7900;
            color: black;
        }
        select{
            width:100%
        }





    </style>


 {% endblock  %}

{% block body  %}
    <body class="d-flex flex-column">
    <main class="container-fluid flex-fill ">
        <br>
        <h1 class="text-center">Ajout d'un fournisseur </h1>
        <br>
        {{ form_start(form, {'attr': {'id': 'myForm'}}) }}
        <div id="smartwizard">

            <ul class="nav" >
                <li class="nav-item">
                    <a class="nav-link" href="#step-1">
                        Description
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#step-2">
                        Profils
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#step-3">
                        Confirmation
                    </a>
                </li>

            </ul>

            <div class="tab-content" id="tab-content">
                <div id="step-1" class="tab-pane" role="tabpanel" aria-labelledby="step-1">
                    <table style="border-color: white">
                        <tr style="border-color: white">
                            <th>

                                {{ form_label(form, 'Nom *', {
                                    'label_attr': {'class': 'input-group-text'}}) }}</th>
                            <th>
                           {{ form_widget(form.name, {
                                    'label_attr': {'class': 'form_control'}}
                                ) }}
                            </th>
                        </tr>
                        <tr>
                            <th> {{ form_label(form, 'Devise *', {
                                    'label_attr': {'class': 'input-group-text'}}) }}</th>
                            <th>{{ form_widget(form.devise, {
                                    'label_attr': {'class': 'form_control'}}
                                ) }}</th>
                        </tr>

                        <tr>
                            <th> {{ form_label(form, 'Interlocuteur *', {
                                    'label_attr': {'class': 'input-group-text'}}) }}</th>
                            <th>{{ form_widget(form.interlocuteur, {
                                    'label_attr': {'class': 'form_control'}}
                                ) }}</th>
                        </tr>
                        <tr>
                            <th> {{ form_label(form, 'Numéro de téléphone', {
                                    'label_attr': {'class': 'input-group-text'}}) }}</th>
                            <th>{{ form_widget(form.phone, {
                                    'label_attr': {'class': 'form_control'}}
                                ) }}</th>
                        </tr>
                        <tr>
                            <th> {{ form_label(form, 'Adresse e-mail', {
                                    'label_attr': {'class': 'input-group-text'}}) }}</th>
                            <th>{{ form_widget(form.mail, {
                                    'label_attr': {'class': 'form_control'}}
                                ) }}</th>
                        </tr>
                        <tr>
                            <th> {{ form_label(form, 'Adresse', {
                                    'label_attr': {'class': 'input-group-text'}}) }}</th>
                            <th>{{ form_widget(form.adress, {
                                    'label_attr': {'class': 'form_control'}}
                                ) }}</th>
                        </tr>
                    </table>

                </div>


                <div id="step-2" class="tab-pane" role="tabpanel" aria-labelledby="step-2">
                    <br>
                    <p id="profildevise"></p>
                    {% macro information_prototype(profil) %}
                        <br>
                       <table>
                           <tr>
                               <th>
                                {{ form_label(profil.name, 'Nom *', {
                                    'label_attr': {'class': 'input-group-text'}}) }}
                               </th>
                               <th>
                            {{ form_widget(profil.name, {
                                'label_attr': {'class': 'form_control'}}
                            ) }}
                               </th>
                           </tr>
                           <tr>
                           <th>
                                {{ form_label(profil.tarif, 'Montant *', {
                                    'label_attr': {'class': 'input-group-text'}}) }}
                           </th>
                               <th>
                            {{ form_widget(profil.tarif, {
                                'label_attr': {'class': 'form_control'}}
                            ) }}
                               </th>
                           </tr>
                       </table>
                        <br>


                    {% endmacro %}





                      <ul class="profils" style="list-style-type: none;" data-prototype="  {{ _self.information_prototype(form.profils.vars.prototype)|e }}">

                      </ul>
                </div>
                <div id="step-3" class="tab-pane" role="tabpanel" aria-labelledby="step-3">

                    <h4>Veuillez vérifier vos données avant de soumettre le formulaire</h4>
                    <div>
                            <h4>Description</h4>
                            <p id="nameof" > </p>
                            <p id="deviseof" > </p>
                            <p id="interlocuteurof" > </p>
                            <p id="phoneof" > </p>
                            <p id="mailof" > </p>
                             <p id="adresseof" > </p>
                    </div>
                    <div id="bigboxprofils">
                        <h4>Profils</h4>
                        <p id="profilsof"> </p>

                    </div>

                </div>

            </div>
        </div>
        {#        </form>#}

        {{ form_end(form) }}
    </main>
    </body>


{% endblock  %}

{% block javascripts %}
    {{ parent() }}
    <script src="https://cdn.jsdelivr.net/npm/smartwizard@5/dist/js/jquery.smartWizard.min.js" type="text/javascript"></script>



    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.3/dist/jquery.validate.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.3/dist/jquery.validate.min.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.3/dist/additional-methods.js" type="text/javascript"></script>
    <script src=" https://cdn.jsdelivr.net/npm/jquery-validation@1.19.3/dist/additional-methods.min.js" type="text/javascript"></script>




    <script>
        $.validator.messages.required = 'Ce champ est requis';
        $.validator.messages.pattern='Le format rentré est incorrect';
        $(document).ready(function (){








            var $collectionHolder;
            var $boutonAjouter = $('<button type="button" className="btn-toolbar add_profil_link sm btn btn-sm text-black"style="background-color: lightgrey">Ajouter un profil</button>');
            var $nouveau = $('<li></li>').append($boutonAjouter )
            ;
            jQuery(document).ready(function () {$collectionHolder = $('ul.profils');
                $collectionHolder.find('li').each(function () {
                    addProfilFormDeleteLink($(this));
                });
                $collectionHolder.append($nouveau);
                $collectionHolder.data('index', $collectionHolder.find('input').length);
                $boutonAjouter.on('click', function (e) {addProfilForm($collectionHolder, $nouveau);
                });

                function addProfilForm($collectionHolder, $newLinkLi) {
                    var prototype = $collectionHolder.data('prototype');
                    var index = $collectionHolder.data('index');
                    var newForm = prototype;
                    newForm = newForm.replace(/__name__/g, index);
                    $collectionHolder.data('index', index + 1);
                    var $newFormLi = $('<li></li>').append(newForm);
                    $newLinkLi.before($newFormLi);
                    addProfilFormDeleteLink($newFormLi);
                    document.getElementById('smartwizard').style.height = "200%";
                    document.getElementById('tab-content').style.height = "200%";


                }
                function addProfilFormDeleteLink($tagFormLi) {
                    var $removeFormButton = $('<button type="button" class="btn-toolbar btn btn-sm text-black" style="background-color: lightgrey; margin-bottom: 2%; font-size: 1em ">Supprimer le profil</button>');
                    $tagFormLi.append($removeFormButton);
                    $removeFormButton.on('click', function (e) {
                        $tagFormLi.remove();
                    });
                }
            })
            ;


            var btnFinish = $('<button></button>').text('Valider').addClass('btn btn-info sw-btn-group-extra d-none')
                .on('click', function(){
                    onsubmit();


                });



            $('#smartwizard').smartWizard({
                selected: 0, // Initial selected step, 0 = first step
                theme: 'arrows', // theme for the wizard, related css need to include for other than default theme
                justified: true, // Nav menu justification. true/false
                darkMode:false, // Enable/disable Dark Mode if the theme supports. true/false
                autoAdjustHeight: true, // Automatically adjust content height
                cycleSteps: false, // Allows to cycle the navigation of steps
                backButtonSupport: true, // Enable the back button support
                enableURLhash: false, // Enable selection of the step based on url hash
                transition: {
                    animation: 'none', // Effect on navigation, none/fade/slide-horizontal/slide-vertical/slide-swing
                    speed: '400', // Transion animation speed
                    easing:'' // Transition animation easing. Not supported without a jQuery easing plugin
                },
                toolbarSettings: {
                    toolbarPosition: 'bottom', // none, top, bottom, both
                    toolbarButtonPosition: 'right', // left, right, center
                    showNextButton: true, // show/hide a Next button
                    showPreviousButton: true, // show/hide a Previous button
                    toolbarExtraButtons: [btnFinish] // Extra buttons to show on toolbar, array of jQuery input/buttons elements

                },
                anchorSettings: {
                    anchorClickable: true, // Enable/Disable anchor navigation
                    enableAllAnchors: false, // Activates all anchors clickable all times
                    markDoneStep: true, // Add done state on navigation
                    markAllPreviousStepsAsDone: true, // When a step selected by url hash, all previous steps are marked done
                    removeDoneStepOnNavigateBack: false, // While navigate back done step after active step will be cleared
                    enableAnchorOnDoneStep: true // Enable/Disable the done steps navigation
                },
                keyboardSettings: {
                    keyNavigation: true, // Enable/Disable keyboard navigation(left and right keys are used if enabled)
                    keyLeft: [37], // Left key code
                    keyRight: [39] // Right key code
                },
                lang: { // Language variables for button
                    next: 'Suivant',
                    previous: 'Précédant'
                },
                disabledSteps: [], // Array Steps disabled
                errorSteps: [], // Highlight step with errors
                hiddenSteps: [], // Hidden steps

            });





            $("#myForm").validate( {
                rules: {
                    name: {
                        required: true
                    }
                },
            });

            $('#smartwizard').on("leaveStep", function(e, anchorObject, stepNumber, stepDirection) {
                if ($('#myForm').valid() && validateSteps(stepNumber) == true ) {
                    if(stepDirection == "2") //here is the final step: Note: 0,1,2
                    {

                        $('.sw-btn-group-extra').removeClass('d-none');
                        $('.sw-btn-next').addClass('d-none');
                    }
                    else
                    {
                        $('.sw-btn-group-extra').addClass('d-none');
                        $('.sw-btn-next').removeClass('d-none');
                        return true;
                    }

                } else {
                    return false
                }
                return true;

            })
            $('.fournisseur_devise').change(function (){
                document.getElementById('profildevise').innerText='Profils du fournisseur en ' + document.getElementById('fournisseur_devise').value+ ' :';
            });


            function validateSteps(stepnumber) {
                var isStepValid = true;
                document.getElementById('nameof').innerText = 'Fournisseur : ' + document.getElementById('fournisseur_name').value;
                document.getElementById('deviseof').innerText = 'Devise : ' + document.getElementById('fournisseur_devise').value;
                document.getElementById('interlocuteurof').innerText = 'Interlocuteur : ' + document.getElementById('fournisseur_interlocuteur').options[document.getElementById('fournisseur_interlocuteur').selectedIndex].innerText;
                if (document.getElementById('fournisseur_phone').value != '') {
                    document.getElementById('phoneof').innerText = 'Numéro de téléphone : ' + document.getElementById('fournisseur_phone').value;
                }
                if (document.getElementById('fournisseur_mail').value != '') {
                    document.getElementById('mailof').innerText = 'Adresse e-mail : ' + document.getElementById('fournisseur_mail').value;
                }
                if (document.getElementById('fournisseur_adress').value != '') {
                    document.getElementById('adresseof').innerText = 'Adresse : ' + document.getElementById('fournisseur_adress').value;
                }

                var listepro = $('ul.profils').find('li').length - 1;
                if (listepro != 0) {
                    var profilsnameof = new Array();
                    var profilstarifof = new Array();
                    var xca = 0;
                    while (profilsnameof.length != listepro) {
                        if ((!!document.getElementById('fournisseur_profils_' + [xca] + '_name')) == true) {
                            profilsnameof.push(document.getElementById('fournisseur_profils_' + [xca] + '_name').value);
                            profilstarifof.push(document.getElementById('fournisseur_profils_' + [xca] + '_tarif').value);
                        }
                        xca = xca + 1;
                    }
                    var textprofils = '';
                    for (var pm = 0; pm < profilstarifof.length; pm++) {
                        textprofils = textprofils + 'Nom : ' + profilsnameof[pm] + ', montant : ' + profilstarifof[pm] + ' ' + document.getElementById('fournisseur_devise').value +'\n';

                    }
                    document.getElementById('profilsof').innerText = textprofils;
                    document.getElementById('bigboxprofils').style.display='block';

                }
                else{
                    document.getElementById('bigboxprofils').style.display='none';
                }
                return isStepValid;
            }



        });





    </script>


{% endblock  %}